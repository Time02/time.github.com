<!DOCTYPE html>
<html lang="zh-CN">

<!-- Head tag -->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <!--Description-->
  
  <meta name="description" content="这是一个关于开发可读、可复用并且可重构的PHP软件指南">
  

  <!--Author-->
  
  <meta name="author" content="Time">
  

  <!--Open Graph Title-->
  
      <meta property="og:title" content="php 简洁之道">
  
  <!--Open Graph Description-->
  
      <meta property="og:description" content="这是一个关于开发可读、可复用并且可重构的PHP软件指南">
  
  <!--Open Graph Site Name-->
  <meta property="og:site_name" content="Time‘blog">
  <!--Type page-->
  
      <meta property="og:type" content="article">
  
  <!--Page Cover-->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <!-- Title -->
  
  <title>php 简洁之道 - Time‘blog</title>


  <link rel="shortcut icon" href="http://img.timeicode.com/yuantu_favicon.png">

  <!-- Custom CSS/Sass -->
  <link rel="stylesheet" href="/css/style.css">

  
<script type="text/javascript">
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?2303c4ad84419f1a5738e7873cd89874";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>


</head>


<body>

  <!-- Nav -->
  <header class="site-header">
  <div class="header-inside">
    <div class="logo">
      <a href="/" rel="home">
        
        <img src="http://img.timeicode.com/yuantu_favicon.png" alt="Time‘blog" height="60">
        
      </a>
    </div>
    <!-- Navigation -->
    <nav class="navbar">
      <!-- Collect the nav links, forms, and other content for toggling -->
      <div class="collapse">
        <ul class="navbar-nav">
          
          
            <li>
              <a href="/.">
                
                  首页
                
              </a>
            </li>
          
            <li>
              <a href="/archives">
                
                  归档
                
              </a>
            </li>
          
            <li>
              <a href="/about">
                
                  关于我
                
              </a>
            </li>
          
        </ul>
      </div>
      <!-- /.navbar-collapse -->
    </nav>
    <div class="button-wrap">
      <button class="menu-toggle">Primary Menu</button>
    </div>
  </div>
</header>


  <!-- Main Content -->
  <div class="content-area">
  <div class="post">
    <!-- Post Content -->
    <div class="container">
      <article>
        <!-- Title date & tags -->
        <div class="post-header">
          <h1 class="entry-title">
            php 简洁之道
            
          </h1>
          <p class="posted-on">
          2018-06-18
          </p>
          <div class="tags-links">
            
              
                <a href="/tags/php/" rel="tag">
                  php
                </a>
              
            
          </div>
        </div>
        <!-- Post Main Content -->
        <div class="entry-content">
          <h2 id="来源"><a href="#来源" class="headerlink" title="来源"></a>来源</h2><p>原文：<a href="https://github.com/php-cpm/clean-code-php" rel="external nofollow noopener noreferrer" target="_blank">clean-code-php</a><br>译文：<a href="https://github.com/nineyang/clean-php-code" rel="external nofollow noopener noreferrer" target="_blank">clean-php-code</a></p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>本文参考自 Robert C. Martin的Clean Code 书中的软件工程师的原则,适用于PHP。这不是风格指南。 这是一个关于开发可读、可复用并且可重构的PHP软件指南。</p>
<p>并不是这里所有的原则都得遵循，甚至很少的能被普遍接受。 这些虽然只是指导，但是都是Clean Code作者多年总结出来的。</p>
<p>本文中的大部分示例的运行环境需要PHP 7.1+。</p>
<hr>
<h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><ul>
<li>使用更有意义和更加直白的命名方式</li>
</ul>
<blockquote>
<p>不友好的:</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ymdstr = $moment-&gt;format(<span class="string">'y-m-d'</span>);</div></pre></td></tr></table></figure>
<blockquote>
<p>友好的:</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$currentDate = $moment-&gt;format(<span class="string">'y-m-d'</span>);</div></pre></td></tr></table></figure>
<ul>
<li>对于同一实体使用相同变量名</li>
</ul>
<blockquote>
<p>不友好的:</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">getUserInfo();</div><div class="line">getUserData();</div><div class="line">getUserRecord();</div><div class="line">getUserProfile();</div></pre></td></tr></table></figure>
<blockquote>
<p>友好的:</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">getUser();</div></pre></td></tr></table></figure>
<ul>
<li>使用可以查找到的变量</li>
</ul>
<blockquote>
<p>我们读的代码量远比我们写过的多。因此，写出可阅读和便于搜索的代码是及其重要的。在我们的程序中写出一些难以理解的变量名，到最后甚至会让自己非常伤脑筋。因此，让你的名字便于搜索吧。</p>
<p>不友好的:</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 这里的448代表什么意思呢？</span></div><div class="line">$result = $serializer-&gt;serialize($data, <span class="number">448</span>);</div></pre></td></tr></table></figure>
<blockquote>
<p>友好的:</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$json = $serializer-&gt;serialize($data, JSON_UNESCAPED_SLASHES | JSON_PRETTY_PRINT | &gt;JSON_UNESCAPED_UNICODE);</div></pre></td></tr></table></figure>
<ul>
<li>使用解释型变量</li>
</ul>
<blockquote>
<p>不友好的</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$address = <span class="string">'One Infinite Loop, Cupertino 95014'</span>;</div><div class="line">$cityZipCodeRegex = <span class="string">'/^[^,]+,\s*(.+?)\s*(\d&#123;5&#125;)$/'</span>;</div><div class="line">preg_match($cityZipCodeRegex, $address, $matches);</div><div class="line">saveCityZipCode($matches[<span class="number">1</span>], $matches[<span class="number">2</span>]);</div></pre></td></tr></table></figure>
<blockquote>
<p>不至于那么糟糕的：稍微好一些，但是这取决于我们对正则的熟练程度。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$address = <span class="string">'One Infinite Loop, Cupertino 95014'</span>;</div><div class="line">$cityZipCodeRegex = <span class="string">'/^[^,]+,\s*(.+?)\s*(\d&#123;5&#125;)$/'</span>;</div><div class="line">preg_match($cityZipCodeRegex, $address, $matches);</div><div class="line">[, $city, $zipCode] = $matches;</div><div class="line">saveCityZipCode($city, $zipCode);</div></pre></td></tr></table></figure>
<blockquote>
<p>友好的:</p>
<p>通过对子模式的重命名减少了我们对正则的熟悉和依赖程度。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$address = <span class="string">'One Infinite Loop, Cupertino 95014'</span>;</div><div class="line">$cityZipCodeRegex = <span class="string">'/^[^,]+,\s*(?&lt;city&gt;.+?)\s*(?&lt;zipCode&gt;\d&#123;5&#125;)$/'</span>;</div><div class="line">preg_match($cityZipCodeRegex, $address, $matches);</div><div class="line">saveCityZipCode($matches[<span class="string">'city'</span>], $matches[<span class="string">'zipCode'</span>]);</div></pre></td></tr></table></figure>
<ul>
<li>嵌套无边，回头是岸</li>
</ul>
<blockquote>
<p>太多的<code>if else</code>嵌套会让你的代码难以阅读和维护。更加直白的代码会好很多。</p>
<ol>
<li>demo1</li>
</ol>
<p>不友好的:</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">isShopOpen</span><span class="params">($day)</span>: <span class="title">bool</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> ($day) &#123;</div><div class="line">        <span class="keyword">if</span> (is_string($day)) &#123;</div><div class="line">            $day = strtolower($day);</div><div class="line">            <span class="keyword">if</span> ($day === <span class="string">'friday'</span>) &#123;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">            &#125; <span class="keyword">elseif</span> ($day === <span class="string">'saturday'</span>) &#123;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">            &#125; <span class="keyword">elseif</span> ($day === <span class="string">'sunday'</span>) &#123;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>友好的:</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">isShopOpen</span><span class="params">(string $day)</span>: <span class="title">bool</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>($day)) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    $openingDays = [</div><div class="line">        <span class="string">'friday'</span>, <span class="string">'saturday'</span>, <span class="string">'sunday'</span></div><div class="line">    ];</div><div class="line"></div><div class="line">    <span class="keyword">return</span> in_array(strtolower($day), $openingDays, <span class="keyword">true</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<ol>
<li>demo2<br>不友好的:</li>
</ol>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">fibonacci</span><span class="params">(int $n)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> ($n &lt; <span class="number">50</span>) &#123;</div><div class="line">        <span class="keyword">if</span> ($n !== <span class="number">0</span>) &#123;</div><div class="line">            <span class="keyword">if</span> ($n !== <span class="number">1</span>) &#123;</div><div class="line">                <span class="keyword">return</span> fibonacci($n - <span class="number">1</span>) + fibonacci($n - <span class="number">2</span>);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        &#125;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">'Not supported'</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>友好的:</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">fibonacci</span><span class="params">(int $n)</span>: <span class="title">int</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> ($n === <span class="number">0</span> || $n === <span class="number">1</span>) &#123;</div><div class="line">        <span class="keyword">return</span> $n;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> ($n &gt; <span class="number">50</span>) &#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> \<span class="keyword">Exception</span>(<span class="string">'Not supported'</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> fibonacci($n - <span class="number">1</span>) + fibonacci($n - <span class="number">2</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>避免使用不合理的变量名</li>
</ul>
<blockquote>
<p>别让其他人去猜你的变量名的意思。<br>更加直白的代码会好很多。</p>
<p>不友好的:</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">$l = [<span class="string">'Austin'</span>, <span class="string">'New York'</span>, <span class="string">'San Francisco'</span>];</div><div class="line"></div><div class="line"><span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; count($l); $i++) &#123;</div><div class="line">    $li = $l[$i];</div><div class="line">    doStuff();</div><div class="line">    doSomeOtherStuff();</div><div class="line">    <span class="comment">// ...</span></div><div class="line">    <span class="comment">// ...</span></div><div class="line">    <span class="comment">// ...</span></div><div class="line">    <span class="comment">// 等等，这个$li是什么意思?</span></div><div class="line">    dispatch($li);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>友好的:</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">$locations = [<span class="string">'Austin'</span>, <span class="string">'New York'</span>, <span class="string">'San Francisco'</span>];</div><div class="line"></div><div class="line"><span class="keyword">foreach</span> ($locations <span class="keyword">as</span> $location) &#123;</div><div class="line">    doStuff();</div><div class="line">    doSomeOtherStuff();</div><div class="line">    <span class="comment">// ...</span></div><div class="line">    <span class="comment">// ...</span></div><div class="line">    <span class="comment">// ...</span></div><div class="line">    dispatch($location);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>别添加没必要的上下文</li>
</ul>
<blockquote>
<p>如果你的类或对象的名字已经传达了一些信息，那么请别在变量名中重复。</p>
<p>不友好的</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> $carMake;</div><div class="line">    <span class="keyword">public</span> $carModel;</div><div class="line">    <span class="keyword">public</span> $carColor;</div><div class="line"></div><div class="line">    <span class="comment">//...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>友好的</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> $make;</div><div class="line">    <span class="keyword">public</span> $model;</div><div class="line">    <span class="keyword">public</span> $color;</div><div class="line"></div><div class="line">    <span class="comment">//...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>用参数默认值代替短路运算或条件运算</li>
</ul>
<blockquote>
<p>不友好的</p>
<p>这里不太合理，因为变量<code>$breweryName</code>有可能是<code>NULL</code>。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">createMicrobrewery</span><span class="params">($breweryName = <span class="string">'Hipster Brew Co.'</span>)</span>: <span class="title">void</span></span></div><div class="line">&#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>不至于那么糟糕的，这种写法要比上一版稍微好理解一些，但是如果能控制变量值获取会更好。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">createMicrobrewery</span><span class="params">($name = null)</span>: <span class="title">void</span></span></div><div class="line">&#123;</div><div class="line">    $breweryName = $name ?: <span class="string">'Hipster Brew Co.'</span>;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>友好的</p>
<p>如果你仅支持 <code>PHP 7+</code>，那么你可以使用<a href="http://php.net/manual/en/functions.arguments.php#functions.arguments.type-declaration" rel="external nofollow noopener noreferrer" target="_blank">类型约束</a>并且保证<code>$http://php.net/manual/en/functions.arguments.php#functions.arguments.type-declaration</code>变量不会为<code>NULL</code>。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">createMicrobrewery</span><span class="params">(string $breweryName = <span class="string">'Hipster Brew Co.'</span>)</span>: <span class="title">void</span></span></div><div class="line">&#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><ul>
<li>函数参数应该控制在两个以下</li>
</ul>
<blockquote>
<p>限制函数的参数对于在对函数做测试来说相当重要。有超过三个可选的参数会给你的测试工作量带来倍速增长。</p>
<p>最理想的情况是没有参数。1-2个参数也还凑合，但是三个参数就应该避免了。参数越多，我们需要维护的就越多。通常，如果你的函&gt;数有超过2个的参数，那么你的这个函数需要处理的事情就太多了。如果的确需要这么多参数，那么在大多数情况下， 用一个对象来处理可能会更合适。</p>
<p>不友好的:</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">createMenu</span><span class="params">(string $title, string $body, string $buttonText, bool $cancellable)</span>: <span class="title">void</span></span></div><div class="line">&#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>友好的:</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MenuConfig</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> $title;</div><div class="line">    <span class="keyword">public</span> $body;</div><div class="line">    <span class="keyword">public</span> $buttonText;</div><div class="line">    <span class="keyword">public</span> $cancellable = <span class="keyword">false</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">$config = <span class="keyword">new</span> MenuConfig();</div><div class="line">$config-&gt;title = <span class="string">'Foo'</span>;</div><div class="line">$config-&gt;body = <span class="string">'Bar'</span>;</div><div class="line">$config-&gt;buttonText = <span class="string">'Baz'</span>;</div><div class="line">$config-&gt;cancellable = <span class="keyword">true</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">createMenu</span><span class="params">(MenuConfig $config)</span>: <span class="title">void</span></span></div><div class="line">&#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>一个函数只做一件事情</li>
</ul>
<blockquote>
<p>在软件工程行业，这是最重要的准则。当函数所处理的事情超过一件，他就会变得难以实现，测试和理解。当你能让一个函数仅仅负责一个事情，他们就会变得容易重构并且理解起来越清晰。光是执行这样一条原则就能让你成为开发者中的佼佼者了。</p>
<p>不友好的:</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">emailClients</span><span class="params">(array $clients)</span>: <span class="title">void</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">foreach</span> ($clients <span class="keyword">as</span> $client) &#123;</div><div class="line">        $clientRecord = $db-&gt;find($client);</div><div class="line">        <span class="keyword">if</span> ($clientRecord-&gt;isActive()) &#123;</div><div class="line">            email($client);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>友好的:</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">emailClients</span><span class="params">(array $clients)</span>: <span class="title">void</span></span></div><div class="line">&#123;</div><div class="line">    $activeClients = activeClients($clients);</div><div class="line">    array_walk($activeClients, <span class="string">'email'</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">activeClients</span><span class="params">(array $clients)</span>: <span class="title">array</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span> array_filter($clients, <span class="string">'isClientActive'</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">isClientActive</span><span class="params">(int $client)</span>: <span class="title">bool</span></span></div><div class="line">&#123;</div><div class="line">    $clientRecord = $db-&gt;find($client);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> $clientRecord-&gt;isActive();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>函数名应该说到做到</li>
</ul>
<blockquote>
<p>不友好的:</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Email</span></span></div><div class="line">&#123;</div><div class="line">    <span class="comment">//...</span></div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span><span class="params">()</span>: <span class="title">void</span></span></div><div class="line">    &#123;</div><div class="line">        mail(<span class="keyword">$this</span>-&gt;to, <span class="keyword">$this</span>-&gt;subject, <span class="keyword">$this</span>-&gt;body);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">$message = <span class="keyword">new</span> Email(...);</div><div class="line"><span class="comment">// 这是什么？这个`handle`方法是什么？我们现在应该写入到一个文件吗？</span></div><div class="line">$message-&gt;handle();</div></pre></td></tr></table></figure>
<blockquote>
<p>友好的:</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Email</span></span></div><div class="line">&#123;</div><div class="line">    <span class="comment">//...</span></div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">send</span><span class="params">()</span>: <span class="title">void</span></span></div><div class="line">    &#123;</div><div class="line">        mail(<span class="keyword">$this</span>-&gt;to, <span class="keyword">$this</span>-&gt;subject, <span class="keyword">$this</span>-&gt;body);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">$message = <span class="keyword">new</span> Email(...);</div><div class="line"><span class="comment">// 清晰并且显而易见</span></div><div class="line">$message-&gt;send();</div></pre></td></tr></table></figure>
<ul>
<li>函数应该只有一层抽象</li>
</ul>
<blockquote>
<p>当你的函数有超过一层的抽象时便意味着这个函数做了太多事情。解耦这个函数致使其变得可重用和更易测试。</p>
<p>不友好的:</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseBetterJSAlternative</span><span class="params">(string $code)</span>: <span class="title">void</span></span></div><div class="line">&#123;</div><div class="line">    $regexes = [</div><div class="line">        <span class="comment">// ...</span></div><div class="line">    ];</div><div class="line"></div><div class="line">    $statements = explode(<span class="string">' '</span>, $code);</div><div class="line">    $tokens = [];</div><div class="line">    <span class="keyword">foreach</span> ($regexes <span class="keyword">as</span> $regex) &#123;</div><div class="line">        <span class="keyword">foreach</span> ($statements <span class="keyword">as</span> $statement) &#123;</div><div class="line">            <span class="comment">// ...</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    $ast = [];</div><div class="line">    <span class="keyword">foreach</span> ($tokens <span class="keyword">as</span> $token) &#123;</div><div class="line">        <span class="comment">// lex...</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">foreach</span> ($ast <span class="keyword">as</span> $node) &#123;</div><div class="line">        <span class="comment">// parse...</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>同样不太友好：我们已经从函数中拆分除了一些东西出来，但是<code>parseBetterJSAlternative()</code>这个函数还是太复杂以至于难以测试。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">tokenize</span><span class="params">(string $code)</span>: <span class="title">array</span></span></div><div class="line">&#123;</div><div class="line">    $regexes = [</div><div class="line">        <span class="comment">// ...</span></div><div class="line">    ];</div><div class="line"></div><div class="line">    $statements = explode(<span class="string">' '</span>, $code);</div><div class="line">    $tokens = [];</div><div class="line">    <span class="keyword">foreach</span> ($regexes <span class="keyword">as</span> $regex) &#123;</div><div class="line">        <span class="keyword">foreach</span> ($statements <span class="keyword">as</span> $statement) &#123;</div><div class="line">            $tokens[] = <span class="comment">/* ... */</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> $tokens;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">lexer</span><span class="params">(array $tokens)</span>: <span class="title">array</span></span></div><div class="line">&#123;</div><div class="line">    $ast = [];</div><div class="line">    <span class="keyword">foreach</span> ($tokens <span class="keyword">as</span> $token) &#123;</div><div class="line">        $ast[] = <span class="comment">/* ... */</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> $ast;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseBetterJSAlternative</span><span class="params">(string $code)</span>: <span class="title">void</span></span></div><div class="line">&#123;</div><div class="line">    $tokens = tokenize($code);</div><div class="line">    $ast = lexer($tokens);</div><div class="line">    <span class="keyword">foreach</span> ($ast <span class="keyword">as</span> $node) &#123;</div><div class="line">        <span class="comment">// parse...</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>友好的</p>
<p>最优解就是把<code>parseBetterJSAlternative()</code>函数依赖的东西分离出来。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tokenizer</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">tokenize</span><span class="params">(string $code)</span>: <span class="title">array</span></span></div><div class="line">    &#123;</div><div class="line">        $regexes = [</div><div class="line">            <span class="comment">// ...</span></div><div class="line">        ];</div><div class="line"></div><div class="line">        $statements = explode(<span class="string">' '</span>, $code);</div><div class="line">        $tokens = [];</div><div class="line">        <span class="keyword">foreach</span> ($regexes <span class="keyword">as</span> $regex) &#123;</div><div class="line">            <span class="keyword">foreach</span> ($statements <span class="keyword">as</span> $statement) &#123;</div><div class="line">                $tokens[] = <span class="comment">/* ... */</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">       <span class="keyword">return</span> $tokens;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Lexer</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">lexify</span><span class="params">(array $tokens)</span>: <span class="title">array</span></span></div><div class="line">    &#123;</div><div class="line">        $ast = [];</div><div class="line">        <span class="keyword">foreach</span> ($tokens <span class="keyword">as</span> $token) &#123;</div><div class="line">            $ast[] = <span class="comment">/* ... */</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">       <span class="keyword">return</span> $ast;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">BetterJSAlternative</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> $tokenizer;</div><div class="line">    <span class="keyword">private</span> $lexer;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(Tokenizer $tokenizer, Lexer $lexer)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;tokenizer = $tokenizer;</div><div class="line">        <span class="keyword">$this</span>-&gt;lexer = $lexer;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">parse</span><span class="params">(string $code)</span>: <span class="title">void</span></span></div><div class="line">    &#123;</div><div class="line">        $tokens = <span class="keyword">$this</span>-&gt;tokenizer-&gt;tokenize($code);</div><div class="line">        $ast = <span class="keyword">$this</span>-&gt;lexer-&gt;lexify($tokens);</div><div class="line">        <span class="keyword">foreach</span> ($ast <span class="keyword">as</span> $node) &#123;</div><div class="line">            <span class="comment">// parse...</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>不要在函数中带入<code>flag</code>相关的参数</li>
</ul>
<blockquote>
<p>当你使用<code>flag</code>时便意味着你的函数做了超过一件事情。前面我们也提到了，函数应该只做一件事情。如果你的代码取决于一个<code>boolean</code>，那么还是把这些内容拆分出来吧。</p>
<p>不友好的</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">createFile</span><span class="params">(string $name, bool $temp = false)</span>: <span class="title">void</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> ($temp) &#123;</div><div class="line">        touch(<span class="string">'./temp/'</span>.$name);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        touch($name);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>友好的</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">createFile</span><span class="params">(string $name)</span>: <span class="title">void</span></span></div><div class="line">&#123;</div><div class="line">    touch($name);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">createTempFile</span><span class="params">(string $name)</span>: <span class="title">void</span></span></div><div class="line">&#123;</div><div class="line">    touch(<span class="string">'./temp/'</span>.$name);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>避免函数带来的副作用</li>
</ul>
<blockquote>
<p>当函数有数据的输入和输出时可能会产生副作用。这个副作用可能被写入一个文件，修改一些全局变量，或者意外的把你的钱转给一个陌生人。</p>
<p>此刻，你可能有时候会需要这些副作用。正如前面所说，你可能需要写入到一个文件中。你需要注意的是把这些你所做的东西在你的掌控之下。别让某些个别函数或者类写入了一个特别的文件。对于所有的都应该一视同仁。有且仅有一个结果。</p>
<p>重要的是要避免那些譬如共享无结构的对象，使用可以写入任何类型的可变数据，不对副作用进行集中处理等常见的陷阱。如果你可以做到，你将会比大多数程序猿更加轻松。</p>
<p>不友好的</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 全局变量被下面的函数引用了。</span></div><div class="line"><span class="comment">// 如果我们在另外一个函数中使用了这个`$name`变量，那么可能会变成一个数组或者程序被打断。</span></div><div class="line">$name = <span class="string">'Ryan McDermott'</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">splitIntoFirstAndLastName</span><span class="params">()</span>: <span class="title">void</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">global</span> $name;</div><div class="line"></div><div class="line">    $name = explode(<span class="string">' '</span>, $name);</div><div class="line">&#125;</div><div class="line"></div><div class="line">splitIntoFirstAndLastName();</div><div class="line"></div><div class="line">var_dump($name); <span class="comment">// ['Ryan', 'McDermott'];</span></div></pre></td></tr></table></figure>
<blockquote>
<p>友好的</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">splitIntoFirstAndLastName</span><span class="params">(string $name)</span>: <span class="title">array</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span> explode(<span class="string">' '</span>, $name);</div><div class="line">&#125;</div><div class="line"></div><div class="line">$name = <span class="string">'Ryan McDermott'</span>;</div><div class="line">$newName = splitIntoFirstAndLastName($name);</div><div class="line"></div><div class="line">var_dump($name); <span class="comment">// 'Ryan McDermott';</span></div><div class="line">var_dump($newName); <span class="comment">// ['Ryan', 'McDermott'];</span></div></pre></td></tr></table></figure>
<ul>
<li>避免写全局方法</li>
</ul>
<blockquote>
<p>在大多数语言中，全局变量被污染都是一个不太好的实践，因为当你引入另外的包时会起冲突并且使用你的<code>API</code>的人知道抛出了一个异常才明白。我们假设一个简单的例子：如果你想要一个配置数组。你可能会写一个类似于<code>config()</code>的全局的函数，但是在引入其他包并在其他地方尝试做同样的事情时会起冲突。</p>
<p>不友好的</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">config</span><span class="params">()</span>: <span class="title">array</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span>  [</div><div class="line">        <span class="string">'foo'</span> =&gt; <span class="string">'bar'</span>,</div><div class="line">    ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>不友好的</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Configuration</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> $configuration = [];</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(array $configuration)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;configuration = $configuration;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span><span class="params">(string $key)</span>: ?<span class="title">string</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;configuration[$key]) ? <span class="keyword">$this</span>-&gt;configuration[$key] : <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>通过创建<code>Configuration</code>类的实例来引入配置</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$configuration = <span class="keyword">new</span> Configuration([</div><div class="line">    <span class="string">'foo'</span> = <span class="string">'bar'</span>,</div><div class="line">]);</div></pre></td></tr></table></figure>
<blockquote>
<p>至此，你就可以是在你的项目中使用这个配置了。</p>
</blockquote>
<ul>
<li>避免使用单例模式</li>
</ul>
<blockquote>
<p>单例模式是一种<a href="https://en.wikipedia.org/wiki/Singleton_pattern" rel="external nofollow noopener noreferrer" target="_blank">反模式</a>。为什么不建议使用:</p>
<ol>
<li>他们通常使用一个<strong>全局实例</strong>，为什么这么糟糕？因为<strong>你隐藏了依赖关系</strong>在你的项目的代码中，而不是通过接口暴露出来。你应该有<a href="https://en.wikipedia.org/wiki/Code_smell" rel="external nofollow noopener noreferrer" target="_blank">意识</a>的去避免那些全局的东西。</li>
<li>他们违背了<strong>单一职责原则</strong>：他们会自己<strong>控制自己的生命周期</strong>。</li>
<li>这种模式会自然而然的使代码<a href="https://en.wikipedia.org/wiki/Coupling_%28computer_programming%29" rel="external nofollow noopener noreferrer" target="_blank">耦合</a>在一起。这会让他们在测试中，很多情况下都<strong>理所当然的不一致</strong>。</li>
<li>他们持续在整个项目的生命周期中。另外一个严重的打击是<strong>当你需要排序测试的时候</strong>，在单元测试中这会是一个不小的麻烦。为什么？因为每个单元测试都应该依赖于另外一个。</li>
</ol>
<p>不友好的</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">DBConnection</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> $instance;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(string $dsn)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="comment">// ...</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getInstance</span><span class="params">()</span>: <span class="title">DBConnection</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">self</span>::$instance === <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">self</span>::$instance = <span class="keyword">new</span> <span class="keyword">self</span>();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> <span class="keyword">self</span>::$instance;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">$singleton = DBConnection::getInstance();</div></pre></td></tr></table></figure>
<p>友好的</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">DBConnection</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(string $dsn)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="comment">// ...</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">     <span class="comment">// ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<blockquote>
<p>使用<a href="http://php.net/manual/en/pdo.construct.php#refsect1-pdo.construct-parameters" rel="external nofollow noopener noreferrer" target="_blank">DSN</a>配置来创建一个<code>DBConnection</code>类的单例。</p>
</blockquote>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$connection = <span class="keyword">new</span> DBConnection($dsn);</div></pre></td></tr></table></figure>
<blockquote>
<blockquote>
<p>此时，在你的项目中必须使用<code>DBConnection</code>的单例。</p>
</blockquote>
</blockquote>
<ul>
<li>对条件判断进行包装</li>
</ul>
<blockquote>
<p>不友好的</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> ($article-&gt;state === <span class="string">'published'</span>) &#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>友好的</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> ($article-&gt;isPublished()) &#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>避免对条件取反</li>
</ul>
<blockquote>
<p>不友好的</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">isDOMNodeNotPresent</span><span class="params">(\DOMNode $node)</span>: <span class="title">bool</span></span></div><div class="line">&#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">if</span> (!isDOMNodeNotPresent($node))</div><div class="line">&#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>友好的</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">isDOMNodePresent</span><span class="params">(\DOMNode $node)</span>: <span class="title">bool</span></span></div><div class="line">&#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">if</span> (isDOMNodePresent($node)) &#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>避免太多的条件嵌套</li>
</ul>
<blockquote>
<p>这似乎是一个不可能的任务。很多人的脑海中可能会在第一时间萦绕“如果没有<code>if</code>条件我还能做什么呢？”。答案就是，在大多数情况下，你可以使用多态去处理这个难题。此外，可能有人又会说了，“即使多态可以做到，但是我们为什么要这么做呢？”，对此我们的解释是，一个函数应该只做一件事情，这也正是我们在前面所提到的让代码更加整洁的原则。当你的函数中使用了太多的<code>if</code>条件时，便意味着你的函数做了超过一件事情。牢记：要专一。</p>
<p>不友好的:</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Airplane</span></span></div><div class="line">&#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getCruisingAltitude</span><span class="params">()</span>: <span class="title">int</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">switch</span> (<span class="keyword">$this</span>-&gt;type) &#123;</div><div class="line">            <span class="keyword">case</span> <span class="string">'777'</span>:</div><div class="line">                <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;getMaxAltitude() - <span class="keyword">$this</span>-&gt;getPassengerCount();</div><div class="line">            <span class="keyword">case</span> <span class="string">'Air Force One'</span>:</div><div class="line">                <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;getMaxAltitude();</div><div class="line">            <span class="keyword">case</span> <span class="string">'Cessna'</span>:</div><div class="line">                <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;getMaxAltitude() - <span class="keyword">$this</span>-&gt;getFuelExpenditure();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>友好的:</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Airplane</span></span></div><div class="line">&#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getCruisingAltitude</span><span class="params">()</span>: <span class="title">int</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Boeing777</span> <span class="keyword">implements</span> <span class="title">Airplane</span></span></div><div class="line">&#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getCruisingAltitude</span><span class="params">()</span>: <span class="title">int</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;getMaxAltitude() - <span class="keyword">$this</span>-&gt;getPassengerCount();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AirForceOne</span> <span class="keyword">implements</span> <span class="title">Airplane</span></span></div><div class="line">&#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getCruisingAltitude</span><span class="params">()</span>: <span class="title">int</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;getMaxAltitude();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cessna</span> <span class="keyword">implements</span> <span class="title">Airplane</span></span></div><div class="line">&#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getCruisingAltitude</span><span class="params">()</span>: <span class="title">int</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;getMaxAltitude() - <span class="keyword">$this</span>-&gt;getFuelExpenditure();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>避免类型检测 (part 1)</li>
</ul>
<blockquote>
<p><code>PHP</code>是一门弱类型语言，这意味着你的函数可以使用任何类型的参数。他在给予你无限的自由的同时又让你困扰，因为有有时候你需要做类型检测。这里有很多方式去避免这种事情，第一种方式就是统一<code>API</code>。</p>
<p>不友好的：</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">travelToTexas</span><span class="params">($vehicle)</span>: <span class="title">void</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> ($vehicle <span class="keyword">instanceof</span> Bicycle) &#123;</div><div class="line">        $vehicle-&gt;pedalTo(<span class="keyword">new</span> Location(<span class="string">'texas'</span>));</div><div class="line">    &#125; <span class="keyword">elseif</span> ($vehicle <span class="keyword">instanceof</span> Car) &#123;</div><div class="line">        $vehicle-&gt;driveTo(<span class="keyword">new</span> Location(<span class="string">'texas'</span>));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>友好的：</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">travelToTexas</span><span class="params">(Traveler $vehicle)</span>: <span class="title">void</span></span></div><div class="line">&#123;</div><div class="line">    $vehicle-&gt;travelTo(<span class="keyword">new</span> Location(<span class="string">'texas'</span>));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>避免类型检测 (part 2)</li>
</ul>
<blockquote>
<p>如果你正使用诸如字符串、整型和数组等基本类型，且要求版本是PHP 7+，不能使用多态，需要类型检测，那你应当考虑<a href="http://php.net/manual/en/functions.arguments.php#functions.arguments.type-declaration" rel="external nofollow noopener noreferrer" target="_blank">类型声明</a>或者严格模式。它提供了基于标准PHP语法的静态类型。手动检查类型的问题是做好了需要好多的废话，好像为了安全就可以不顾损失可读性。保持你的<code>PHP</code>代码整洁，写好测试，保持良好的回顾代码的习惯。否则的话，那就还是用PHP严格类型声明和严格模式来确保安全吧。</p>
<p>不友好的:</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">combine</span><span class="params">($val1, $val2)</span>: <span class="title">int</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (!is_numeric($val1) || !is_numeric($val2)) &#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> \<span class="keyword">Exception</span>(<span class="string">'Must be of type Number'</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> $val1 + $val2;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>友好的:</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">combine</span><span class="params">(int $val1, int $val2)</span>: <span class="title">int</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span> $val1 + $val2;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>移除那些没有使用的代码</li>
</ul>
<blockquote>
<p>没有再使用的代码就好比重复代码一样糟糕。在你的代码库中完全没有必要保留。如果确定不再使用，那就把它删掉吧！如果有一天你要使用，你也可以在你的版本记录中找到它。</p>
<p>不友好的:</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">oldRequestModule</span><span class="params">(string $url)</span>: <span class="title">void</span></span></div><div class="line">&#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">newRequestModule</span><span class="params">(string $url)</span>: <span class="title">void</span></span></div><div class="line">&#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">$request = newRequestModule($requestUrl);</div><div class="line">inventoryTracker(<span class="string">'apples'</span>, $request, <span class="string">'www.inventory-awesome.io'</span>);</div></pre></td></tr></table></figure>
<blockquote>
<p>友好的:</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">requestModule</span><span class="params">(string $url)</span>: <span class="title">void</span></span></div><div class="line">&#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">$request = requestModule($requestUrl);</div><div class="line">inventoryTracker(<span class="string">'apples'</span>, $request, <span class="string">'www.inventory-awesome.io'</span>);</div></pre></td></tr></table></figure>
<hr>
<h2 id="对象和数据结构"><a href="#对象和数据结构" class="headerlink" title="对象和数据结构"></a>对象和数据结构</h2><ul>
<li>使用对象封装</li>
</ul>
<blockquote>
<p>在<code>PHP</code>中你可以设置<code>public</code>，<code>protected</code>，和<code>private</code>关键词来修饰你的方法。当你使用它们，你就可以在一个对象中控制这些属性的修改权限了。</p>
<ul>
<li>当你想要对对象的属性进行除了“获取”之外的操作时，你不必再去浏览并在代码库中修改权限。</li>
<li>当你要做一些修改属性的操作时，你更易于在代码中做逻辑验证。</li>
<li>封装内部表示。</li>
<li>当你在做获取和设置属性的操作时，更易于添加<code>log</code>或<code>error</code>的操作。</li>
<li>当其他<code>class</code>继承了这个基类，你可以重写默认的方法。</li>
<li>你可以为一个服务延迟的去获取这个对象的属性值。</li>
</ul>
<p>不太友好的:</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">BankAccount</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> $balance = <span class="number">1000</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">$bankAccount = <span class="keyword">new</span> BankAccount();</div><div class="line"></div><div class="line"><span class="comment">// Buy shoes...</span></div><div class="line">$bankAccount-&gt;balance -= <span class="number">100</span>;</div></pre></td></tr></table></figure>
<blockquote>
<p>友好的:</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">BankAccount</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> $balance;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(int $balance = <span class="number">1000</span>)</span></span></div><div class="line">    &#123;</div><div class="line">      <span class="keyword">$this</span>-&gt;balance = $balance;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">withdraw</span><span class="params">(int $amount)</span>: <span class="title">void</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span> ($amount &gt; <span class="keyword">$this</span>-&gt;balance) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> \<span class="keyword">Exception</span>(<span class="string">'Amount greater than available balance.'</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">$this</span>-&gt;balance -= $amount;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">deposit</span><span class="params">(int $amount)</span>: <span class="title">void</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;balance += $amount;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getBalance</span><span class="params">()</span>: <span class="title">int</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;balance;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">$bankAccount = <span class="keyword">new</span> BankAccount();</div><div class="line"></div><div class="line"><span class="comment">// Buy shoes...</span></div><div class="line">$bankAccount-&gt;withdraw($shoesPrice);</div><div class="line"></div><div class="line"><span class="comment">// Get balance</span></div><div class="line">$balance = $bankAccount-&gt;getBalance();</div></pre></td></tr></table></figure>
<ul>
<li>在对象的属性上可以使用<code>private/protected</code>限定</li>
</ul>
<blockquote>
<ul>
<li><code>public</code>修饰的方法和属性同上来说被修改是比较危险的，因为一些外部的代码可以轻易的依赖于他们并且你没办法控制哪些代码依赖于他们。<strong>对于所有用户的类来说，在类中可以修改是相当危险的。</strong></li>
<li><code>protected</code>修饰器和<code>public</code>同样危险，因为他们在继承链中同样可以操作。二者的区别仅限于权限机制，并且封装保持不变。<strong>对于所有子类来说，在类中修改也是相当危险的。</strong></li>
<li><code>private</code>修饰符保证了代码只有在<strong>自己类的内部修改才是危险的。</strong></li>
</ul>
<p>因此，当你在需要对外部的类设置权限时使用<code>private</code>修饰符去取代<code>public/protected</code>吧。</p>
<p>如果需要了解更多信息你可以读<a href="https://github.com/fabpot" rel="external nofollow noopener noreferrer" target="_blank">Fabien Potencier</a>写的这篇<a href="http://fabien.potencier.org/pragmatism-over-theory-protected-vs-private.html" rel="external nofollow noopener noreferrer" target="_blank">文章</a></p>
<p>不太友好的:</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> $name;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(string $name)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;name = $name;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">$employee = <span class="keyword">new</span> Employee(<span class="string">'John Doe'</span>);</div><div class="line"><span class="keyword">echo</span> <span class="string">'Employee name: '</span>.$employee-&gt;name; <span class="comment">// Employee name: John Doe</span></div></pre></td></tr></table></figure>
<blockquote>
<p>友好的:</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> $name;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(string $name)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;name = $name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getName</span><span class="params">()</span>: <span class="title">string</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;name;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">$employee = <span class="keyword">new</span> Employee(<span class="string">'John Doe'</span>);</div><div class="line"><span class="keyword">echo</span> <span class="string">'Employee name: '</span>.$employee-&gt;getName(); <span class="comment">// Employee name: John Doe</span></div></pre></td></tr></table></figure>
<ul>
<li>组合优于继承</li>
</ul>
<blockquote>
<p>正如<code>the Gang of Four</code>在著名的<a href="https://en.wikipedia.org/wiki/Design_Patterns" rel="external nofollow noopener noreferrer" target="_blank"><em>Design Patterns</em></a>中所说，你应该尽可能的使用组合而不是继承。不管是使用组合还是继承都有很多的优点。最重要的一个准则在于当你本能的想要使用继承时，不妨思考一下组合是否能让你的问题解决的更加优雅。在某些时候确实如此。</p>
<p>你可能会这么问了，“那到底什么时候我应该使用继承呢？”这完全取决你你手头上的问题，下面正好有一些继承优于组合的例子：</p>
<ol>
<li>你的继承表达了“是一个”而不是“有一个”的关系(Human-&gt;Animal vs. User-&gt;UserDetails)。</li>
<li>你可能会重复的使用基类的代码(Humans can move like all animals)。</li>
<li>你渴望在修改代码的时候通过基类来统一调度(Change the caloric expenditure of all animals when they move)。</li>
</ol>
<p>不友好的:</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> $name;</div><div class="line">    <span class="keyword">private</span> $email;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(string $name, string $email)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;name = $name;</div><div class="line">        <span class="keyword">$this</span>-&gt;email = $email;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 这里不太合理的原因在于并非所有的职员都有`tax`这个特征。</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">EmployeeTaxData</span> <span class="keyword">extends</span> <span class="title">Employee</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> $ssn;</div><div class="line">    <span class="keyword">private</span> $salary;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(string $name, string $email, string $ssn, string $salary)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">parent</span>::__construct($name, $email);</div><div class="line"></div><div class="line">        <span class="keyword">$this</span>-&gt;ssn = $ssn;</div><div class="line">        <span class="keyword">$this</span>-&gt;salary = $salary;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>友好的:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">EmployeeTaxData</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> $ssn;</div><div class="line">    <span class="keyword">private</span> $salary;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(string $ssn, string $salary)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;ssn = $ssn;</div><div class="line">        <span class="keyword">$this</span>-&gt;salary = $salary;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> $name;</div><div class="line">    <span class="keyword">private</span> $email;</div><div class="line">    <span class="keyword">private</span> $taxData;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(string $name, string $email)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;name = $name;</div><div class="line">        <span class="keyword">$this</span>-&gt;email = $email;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setTaxData</span><span class="params">(string $ssn, string $salary)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;taxData = <span class="keyword">new</span> EmployeeTaxData($ssn, $salary);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
</blockquote>
<ul>
<li>避免链式调用(连贯接口)</li>
</ul>
<blockquote>
<p>在使用一些<a href="https://en.wikipedia.org/wiki/Method_chaining" rel="external nofollow noopener noreferrer" target="_blank">链式方法</a>时，这种<a href="https://en.wikipedia.org/wiki/Fluent_interface" rel="external nofollow noopener noreferrer" target="_blank">连贯接口</a>可以不断地指向当前对象让我们的代码显得更加清晰可读。</p>
<p>通常情况下，我们在构建对象时都可以利用他的上下文这一特征，因为这种模式可以减少代码的冗余，不过在<a href="(https://phpunit.de/manual/current/en/test-doubles.html">PHPUnit Mock Builder</a>或者<a href="http://docs.doctrine-project.org/projects/doctrine-dbal/en/latest/reference/query-builder.html" rel="external nofollow noopener noreferrer" target="_blank">Doctrine Query Builder</a>所提及的，有时候这种方式会带来一些麻烦：</p>
<ol>
<li>破坏<a href="https://en.wikipedia.org/wiki/Encapsulation_%28object-oriented_programming%29" rel="external nofollow noopener noreferrer" target="_blank">封装</a></li>
<li>破坏<a href="https://en.wikipedia.org/wiki/Decorator_pattern" rel="external nofollow noopener noreferrer" target="_blank">设计</a></li>
<li>难以<a href="https://en.wikipedia.org/wiki/Mock_object" rel="external nofollow noopener noreferrer" target="_blank">测试</a></li>
<li>可能会难以阅读</li>
</ol>
<p>如果需要了解更多信息你可以读<a href="https://github.com/Ocramius" rel="external nofollow noopener noreferrer" target="_blank">Marco Pivetta</a>写的这篇<a href="https://ocramius.github.io/blog/fluent-interfaces-are-evil/" rel="external nofollow noopener noreferrer" target="_blank">文章</a></p>
<p>友好的:</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> $make = <span class="string">'Honda'</span>;</div><div class="line">    <span class="keyword">private</span> $model = <span class="string">'Accord'</span>;</div><div class="line">    <span class="keyword">private</span> $color = <span class="string">'white'</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setMake</span><span class="params">(string $make)</span>: <span class="title">self</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;make = $make;</div><div class="line"></div><div class="line">        <span class="comment">// <span class="doctag">NOTE:</span> Returning this for chaining</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setModel</span><span class="params">(string $model)</span>: <span class="title">self</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;model = $model;</div><div class="line"></div><div class="line">        <span class="comment">// <span class="doctag">NOTE:</span> Returning this for chaining</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setColor</span><span class="params">(string $color)</span>: <span class="title">self</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;color = $color;</div><div class="line"></div><div class="line">        <span class="comment">// <span class="doctag">NOTE:</span> Returning this for chaining</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">dump</span><span class="params">()</span>: <span class="title">void</span></span></div><div class="line">    &#123;</div><div class="line">        var_dump(<span class="keyword">$this</span>-&gt;make, <span class="keyword">$this</span>-&gt;model, <span class="keyword">$this</span>-&gt;color);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">$car = (<span class="keyword">new</span> Car())</div><div class="line">  -&gt;setColor(<span class="string">'pink'</span>)</div><div class="line">  -&gt;setMake(<span class="string">'Ford'</span>)</div><div class="line">  -&gt;setModel(<span class="string">'F-150'</span>)</div><div class="line">  -&gt;dump();</div></pre></td></tr></table></figure>
<blockquote>
<p>不友好的:</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> $make = <span class="string">'Honda'</span>;</div><div class="line">    <span class="keyword">private</span> $model = <span class="string">'Accord'</span>;</div><div class="line">    <span class="keyword">private</span> $color = <span class="string">'white'</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setMake</span><span class="params">(string $make)</span>: <span class="title">void</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;make = $make;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setModel</span><span class="params">(string $model)</span>: <span class="title">void</span></span></div><div class="line">   &#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;model = $model;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setColor</span><span class="params">(string $color)</span>: <span class="title">void</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;color = $color;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">dump</span><span class="params">()</span>: <span class="title">void</span></span></div><div class="line">    &#123;</div><div class="line">        var_dump(<span class="keyword">$this</span>-&gt;make, <span class="keyword">$this</span>-&gt;model, <span class="keyword">$this</span>-&gt;color);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">$car = <span class="keyword">new</span> Car();</div><div class="line">$car-&gt;setColor(<span class="string">'pink'</span>);</div><div class="line">$car-&gt;setMake(<span class="string">'Ford'</span>);</div><div class="line">$car-&gt;setModel(<span class="string">'F-150'</span>);</div><div class="line">$car-&gt;dump();</div></pre></td></tr></table></figure>
<hr>
<h2 id="SOLID"><a href="#SOLID" class="headerlink" title="SOLID"></a>SOLID</h2><blockquote>
<p><strong>SOLID</strong>最开始是由Robert Martin提出的五个准则，并最后由Michael Feathers命名的简写，这五个是在面对对象设计中的五个基本原则。</p>
<ul>
<li>S: 职责单一原则 (SRP)</li>
<li>O: 开闭原则 (OCP)</li>
<li>L: 里氏替换原则 (LSP)</li>
<li>I: 接口隔离原则 (ISP)</li>
<li>D: 依赖反转原则 (DIP)</li>
</ul>
</blockquote>
<ul>
<li>职责单一原则 (SRP)</li>
</ul>
<blockquote>
<p>正如Clean Code所述，“修改类应该只有一个理由”。我们总是喜欢在类中写入太多的方法，就像你在飞机上塞满你的行李箱。在这种情况下你的类没有高内聚的概念并且留下了很多可以修改的理由。尽可能的减少你需要去修改类的时间是非常重要的。如果在你的单个类中有太多的方法并且你经常修改的话，那么如果其他代码库中有引入这样的模块的话会非常难以理解。</p>
<p>不友好的:</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserSettings</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> $user;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(User $user)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;user = $user;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">changeSettings</span><span class="params">(array $settings)</span>: <span class="title">void</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;verifyCredentials()) &#123;</div><div class="line">            <span class="comment">// ...</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">verifyCredentials</span><span class="params">()</span>: <span class="title">bool</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="comment">// ...</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>友好的:</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserAuth</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> $user;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(User $user)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;user = $user;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">verifyCredentials</span><span class="params">()</span>: <span class="title">bool</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="comment">// ...</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserSettings</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> $user;</div><div class="line">    <span class="keyword">private</span> $auth;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(User $user)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;user = $user;</div><div class="line">        <span class="keyword">$this</span>-&gt;auth = <span class="keyword">new</span> UserAuth($user);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">changeSettings</span><span class="params">(array $settings)</span>: <span class="title">void</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;auth-&gt;verifyCredentials()) &#123;</div><div class="line">            <span class="comment">// ...</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>开闭原则 (OCP)</li>
</ul>
<blockquote>
<p>正如Bertrand Meyer所说，“软件开发应该对扩展开发，对修改关闭。”这是什么意思呢？这个原则的意思大概就是说你应该允许其他人在不修改已经存在的功能的情况下去增加新功能。</p>
<p>不友好的</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Adapter</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">protected</span> $name;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getName</span><span class="params">()</span>: <span class="title">string</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;name;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AjaxAdapter</span> <span class="keyword">extends</span> <span class="title">Adapter</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">       <span class="keyword">parent</span>::__construct();</div><div class="line"></div><div class="line">        <span class="keyword">$this</span>-&gt;name = <span class="string">'ajaxAdapter'</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">NodeAdapter</span> <span class="keyword">extends</span> <span class="title">Adapter</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">parent</span>::__construct();</div><div class="line"></div><div class="line">        <span class="keyword">$this</span>-&gt;name = <span class="string">'nodeAdapter'</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">HttpRequester</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> $adapter;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(Adapter $adapter)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;adapter = $adapter;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">fetch</span><span class="params">(string $url)</span>: <span class="title">Promise</span></span></div><div class="line">    &#123;</div><div class="line">        $adapterName = <span class="keyword">$this</span>-&gt;adapter-&gt;getName();</div><div class="line"></div><div class="line">        <span class="keyword">if</span> ($adapterName === <span class="string">'ajaxAdapter'</span>) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;makeAjaxCall($url);</div><div class="line">        &#125; <span class="keyword">elseif</span> ($adapterName === <span class="string">'httpNodeAdapter'</span>) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;makeHttpCall($url);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">makeAjaxCall</span><span class="params">(string $url)</span>: <span class="title">Promise</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="comment">// request and return promise</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">makeHttpCall</span><span class="params">(string $url)</span>: <span class="title">Promise</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="comment">// request and return promise</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>友好的:</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Adapter</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">request</span><span class="params">(string $url)</span>: <span class="title">Promise</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AjaxAdapter</span> <span class="keyword">implements</span> <span class="title">Adapter</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">request</span><span class="params">(string $url)</span>: <span class="title">Promise</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="comment">// request and return promise</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">NodeAdapter</span> <span class="keyword">implements</span> <span class="title">Adapter</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">request</span><span class="params">(string $url)</span>: <span class="title">Promise</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="comment">// request and return promise</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">HttpRequester</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> $adapter;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(Adapter $adapter)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">$this</span>-adapter = $adapter;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">fetch</span><span class="params">(string $url)</span>: <span class="title">Promise</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;adapter-&gt;request($url);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>里氏替换原则 (LSP)</li>
</ul>
<blockquote>
<p>这本身是一个非常简单的原则却起了一个不太容易理解的名字。这个原则通常的定义是“如果S是T的一个子类，那么对象T可以在没有任何警告的情况下被他的子类替换（例如：对象S可能代替对象T）一些更合适的属性。”好像更难理解了。</p>
<p>最好的解释就是说如果你有一个父类和子类，那么你的父类和子类可以在原来的基础上任意交换。这个可能还是难以理解，我们举一个正方形-长方形的例子吧。在数学中，一个矩形属于长方形，但是如果在你的模型中通过继承使用了“is-a”的关系就不对了。</p>
<p>不友好的:</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">protected</span> $width = <span class="number">0</span>;</div><div class="line">    <span class="keyword">protected</span> $height = <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">render</span><span class="params">(int $area)</span>: <span class="title">void</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="comment">// ...</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setWidth</span><span class="params">(int $width)</span>: <span class="title">void</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;width = $width;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setHeight</span><span class="params">(int $height)</span>: <span class="title">void</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;height = $height;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getArea</span><span class="params">()</span>: <span class="title">int</span></span></div><div class="line">    &#123;</div><div class="line">       <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;width * <span class="keyword">$this</span>-&gt;height;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">Rectangle</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setWidth</span><span class="params">(int $width)</span>: <span class="title">void</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;width = <span class="keyword">$this</span>-&gt;height = $width;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setHeight</span><span class="params">(int $height)</span>: <span class="title">void</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;width = <span class="keyword">$this</span>-&gt;height = $height;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">renderLargeRectangles</span><span class="params">(array $rectangles)</span>: <span class="title">void</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">foreach</span> ($rectangles <span class="keyword">as</span> $rectangle) &#123;</div><div class="line">        $rectangle-&gt;setWidth(<span class="number">4</span>);</div><div class="line">        $rectangle-&gt;setHeight(<span class="number">5</span>);</div><div class="line">        $area = $rectangle-&gt;getArea(); <span class="comment">// BAD: Will return 25 for Square. Should be 20.</span></div><div class="line">        $rectangle-&gt;render($area);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">$rectangles = [<span class="keyword">new</span> Rectangle(), <span class="keyword">new</span> Rectangle(), <span class="keyword">new</span> Square()];</div><div class="line">renderLargeRectangles($rectangles);</div></pre></td></tr></table></figure>
<blockquote>
<p>友好的:</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Shape</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">protected</span> $width = <span class="number">0</span>;</div><div class="line">    <span class="keyword">protected</span> $height = <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="keyword">abstract</span> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getArea</span><span class="params">()</span>: <span class="title">int</span></span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">render</span><span class="params">(int $area)</span>: <span class="title">void</span></span></div><div class="line">   &#123;</div><div class="line">        <span class="comment">// ...</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> <span class="keyword">extends</span> <span class="title">Shape</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setWidth</span><span class="params">(int $width)</span>: <span class="title">void</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;width = $width;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setHeight</span><span class="params">(int $height)</span>: <span class="title">void</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;height = $height;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getArea</span><span class="params">()</span>: <span class="title">int</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;width * <span class="keyword">$this</span>-&gt;height;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">Shape</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> $length = <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setLength</span><span class="params">(int $length)</span>: <span class="title">void</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;length = $length;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getArea</span><span class="params">()</span>: <span class="title">int</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> pow(<span class="keyword">$this</span>-&gt;length, <span class="number">2</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">renderLargeRectangles</span><span class="params">(array $rectangles)</span>: <span class="title">void</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">foreach</span> ($rectangles <span class="keyword">as</span> $rectangle) &#123;</div><div class="line">        <span class="keyword">if</span> ($rectangle <span class="keyword">instanceof</span> Square) &#123;</div><div class="line">            $rectangle-&gt;setLength(<span class="number">5</span>);</div><div class="line">        &#125; <span class="keyword">elseif</span> ($rectangle <span class="keyword">instanceof</span> Rectangle) &#123;</div><div class="line">            $rectangle-&gt;setWidth(<span class="number">4</span>);</div><div class="line">            $rectangle-&gt;setHeight(<span class="number">5</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        $area = $rectangle-&gt;getArea();</div><div class="line">        $rectangle-&gt;render($area);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">$shapes = [<span class="keyword">new</span> Rectangle(), <span class="keyword">new</span> Rectangle(), <span class="keyword">new</span> Square()];</div><div class="line">renderLargeRectangles($shapes);</div></pre></td></tr></table></figure>
<ul>
<li>接口隔离原则 (ISP)</li>
</ul>
<blockquote>
<p>ISP的意思就是说“使用者不应该强制使用它不需要的接口”。</p>
<p>当一个类需要大量的设置是一个不错的例子去解释这个原则。为了方便去调用这个接口需要做大量的设置，但是大多数情况下是不需要的。强制让他们使用这些设置会让整个接口显得臃肿。</p>
<p>不友好的:</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Employee</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">work</span><span class="params">()</span>: <span class="title">void</span></span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">eat</span><span class="params">()</span>: <span class="title">void</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Human</span> <span class="keyword">implements</span> <span class="title">Employee</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">work</span><span class="params">()</span>: <span class="title">void</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="comment">// ....working</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">eat</span><span class="params">()</span>: <span class="title">void</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="comment">// ...... eating in lunch break</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Robot</span> <span class="keyword">implements</span> <span class="title">Employee</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">work</span><span class="params">()</span>: <span class="title">void</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="comment">//.... working much more</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">eat</span><span class="params">()</span>: <span class="title">void</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="comment">//.... robot can't eat, but it must implement this method</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>友好的:</p>
<blockquote>
<p>并非每一个工人都是职员，但是每一个职员都是工人。</p>
</blockquote>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Workable</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">work</span><span class="params">()</span>: <span class="title">void</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Feedable</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">eat</span><span class="params">()</span>: <span class="title">void</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Employee</span> <span class="keyword">extends</span> <span class="title">Feedable</span>, <span class="title">Workable</span></span></div><div class="line">&#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Human</span> <span class="keyword">implements</span> <span class="title">Employee</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">work</span><span class="params">()</span>: <span class="title">void</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="comment">// ....working</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">eat</span><span class="params">()</span>: <span class="title">void</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="comment">//.... eating in lunch break</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// robot can only work</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Robot</span> <span class="keyword">implements</span> <span class="title">Workable</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">work</span><span class="params">()</span>: <span class="title">void</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="comment">// ....working</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>依赖反转原则 (DIP)</li>
</ul>
<blockquote>
<p>这个原则有两个需要注意的地方：</p>
<ol>
<li>高阶模块不能依赖于低阶模块。他们都应该依赖于抽象。</li>
<li>抽象不应该依赖于实现，实现应该依赖于抽象。</li>
</ol>
<p>第一点可能有点难以理解，但是如果你有使用过像<code>Symfony</code>的<code>PHP</code>框架，你应该有见到过依赖注入这样的原则的实现。尽管他们是不一样的概念，<code>DIP</code>让高阶模块从我们所知道的低阶模块中分离出去。可以通过<code>DI</code>这种方式实现。一个巨大的好处在于它解耦了不同的模块。耦合是一个非常不好的开发模式，因为它会让你的代码难以重构。</p>
<p>不友好的:</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">work</span><span class="params">()</span>: <span class="title">void</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="comment">// ....working</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Robot</span> <span class="keyword">extends</span> <span class="title">Employee</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">work</span><span class="params">()</span>: <span class="title">void</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="comment">//.... working much more</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Manager</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> $employee;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(Employee $employee)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">$this</span>-employee = $employee;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">manage</span><span class="params">()</span>: <span class="title">void</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;employee-&gt;work();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>友好的</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Employee</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">work</span><span class="params">()</span>: <span class="title">void</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Human</span> <span class="keyword">implements</span> <span class="title">Employee</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">work</span><span class="params">()</span>: <span class="title">void</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="comment">// ....working</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Robot</span> <span class="keyword">implements</span> <span class="title">Employee</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">work</span><span class="params">()</span>: <span class="title">void</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="comment">//.... working much more</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Manager</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> $employee;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(Employee $employee)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;employee = $employee;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">manage</span><span class="params">()</span>: <span class="title">void</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">$this</span>-&gt;employee-&gt;work();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="别重复你的代码-DRY"><a href="#别重复你的代码-DRY" class="headerlink" title="别重复你的代码 (DRY)"></a>别重复你的代码 (DRY)</h2><blockquote>
<p>尝试去研究<a href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself" rel="external nofollow noopener noreferrer" target="_blank">DRY</a>原则。</p>
<p>尽可能别去复制代码。复制代码非常不好，因为这意味着将来有需要修改的业务逻辑时你需要修改不止一处。</p>
<p>想象一下你在经营一个餐馆并且你需要经常整理你的存货清单：你所有的土豆，洋葱，大蒜，辣椒等。如果你有多个列表来管理进销记录，当你用其中一些土豆做菜时你需要更新所有的列表。如果你只有一个列表的话只有一个地方需要更新!</p>
<p>大多数情况下你有重复的代码是因为你有超过两处细微的差别，他们大部分都是相同的，但是他们的不同之处又不得不让你去分成不同的方法去处理相同的事情。移除这些重复的代码意味着你需要创建一个可以用一个方法/模块/类来处理的抽象。</p>
<p>使用一个抽象是关键的，这也是为什么在类中你要遵循<code>SOLID</code>原则的原因。一个不优雅的抽象往往比重复的代码更糟糕，所以要谨慎使用！说了这么多，如果你已经可以构造一个优雅的抽象，那就赶紧去做吧！别重复你的代码，否则当你需要修改时你会发现你要修改许多地方。</p>
<p>不友好的:</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">showDeveloperList</span><span class="params">(array $developers)</span>: <span class="title">void</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">foreach</span> ($developers <span class="keyword">as</span> $developer) &#123;</div><div class="line">        $expectedSalary = $developer-&gt;calculateExpectedSalary();</div><div class="line">        $experience = $developer-&gt;getExperience();</div><div class="line">        $githubLink = $developer-&gt;getGithubLink();</div><div class="line">        $data = [</div><div class="line">            $expectedSalary,</div><div class="line">            $experience,</div><div class="line">            $githubLink</div><div class="line">        ];</div><div class="line"></div><div class="line">        render($data);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">showManagerList</span><span class="params">(array $managers)</span>: <span class="title">void</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">foreach</span> ($managers <span class="keyword">as</span> $manager) &#123;</div><div class="line">        $expectedSalary = $manager-&gt;calculateExpectedSalary();</div><div class="line">        $experience = $manager-&gt;getExperience();</div><div class="line">        $githubLink = $manager-&gt;getGithubLink();</div><div class="line">        $data = [</div><div class="line">            $expectedSalary,</div><div class="line">            $experience,</div><div class="line">            $githubLink</div><div class="line">        ];</div><div class="line"></div><div class="line">        render($data);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>友好的:</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">showList</span><span class="params">(array $employees)</span>: <span class="title">void</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">foreach</span> ($employees <span class="keyword">as</span> $employee) &#123;</div><div class="line">        $expectedSalary = $employee-&gt;calculateExpectedSalary();</div><div class="line">        $experience = $employee-&gt;getExperience();</div><div class="line">        $githubLink = $employee-&gt;getGithubLink();</div><div class="line">        $data = [</div><div class="line">            $expectedSalary,</div><div class="line">            $experience,</div><div class="line">            $githubLink</div><div class="line">        ];</div><div class="line"></div><div class="line">        render($data);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>非常优雅的:</p>
<p>如果能更简洁那就更好了。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">showList</span><span class="params">(array $employees)</span>: <span class="title">void</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">foreach</span> ($employees <span class="keyword">as</span> $employee) &#123;</div><div class="line">        render([</div><div class="line">            $employee-&gt;calculateExpectedSalary(),</div><div class="line">            $employee-&gt;getExperience(),</div><div class="line">            $employee-&gt;getGithubLink()</div><div class="line">        ]);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ps：插图来自：<a href="https://pixabay.com" rel="external nofollow noopener noreferrer" target="_blank">pixabay.com</a> 授权</p>

        </div>
      </article>
    </div>
    <!-- Comments -->
    <div class="container">
      
<section id="comment">
  <!-- <h1 class="title">留言</h1> -->

  
  <div id="disqus_thread">
    <script type="text/javascript">
    var disqus_config = function () {
          this.page.url = window.location.href;
          this.page.identifier = 'post-php-简洁之道';
          this.page.title = 'php 简洁之道';
      };
    </script>
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
  
</section>


    </div>
    <!-- Pre or Next -->
    <div class="nav-links">
      
      
        <div class="nav-next">
          <a href="/2018/06/14/通过Let-s-Encrypt配置SSL通配符证书/" rel="prev">下一页 <span class="meta-arraw meta-arraw-right"></span></a>
        </div>
      
    </div>

  </div>
</div>


  <!-- Footer -->
  <!-- Footer-widgets -->
<div class="footer-widgets">
  <div class="row inside-wrapper">
    <div class="col-1-3">
      <aside>
        <h1 class="widget-title">关于本站</h1>
        <div class="custom-widget-content">
          
          time blog | php | mysql | python | btc | xmr
        </div>
      </aside>
    </div>
    <div class="col-1-3">
      <aside>
        <h1 class="widget-title">与我联系</h1>
        <div class="widget-text">
          
            
              <a href="https://github.com/time02" class="icon icon-github" target="_blank" rel="external nofollow noopener noreferrer">github</a>
            
              <a href="mailto:wjhechen@gmail.com" class="icon icon-mail" target="_blank" rel="external nofollow noopener noreferrer">mail</a>
            
          
        </div>
      </aside>
    </div>
    <div class="col-1-3">
      <aside>
        <h1 class="widget-title">站内搜索</h1>
        <div class="widget-text">
          <form onsubmit="return appDaily.submitSearch('')">
            <p>
              <input type="text" placeholder="search..." id="homeSearchInput">
            </p>
            <!-- <input type="submit" value="GO"> -->
          </form>
        </div>
      </aside>
    </div>
  </div>
</div>
<!-- Footer -->
<footer class="site-info">
  <p>
    <span>Time‘blog &copy; 2018</span>
    
      <span class="split">|</span>
      <span>Powered by <a href="https://hexo.io/" target="_blank" rel="external nofollow noopener noreferrer">Hexo</a> with Theme <a href="https://github.com/GallenHu/hexo-theme-Daily" target="_blank" rel="external nofollow noopener noreferrer">Daily</a></span>
    
  </p>
</footer>


  <!-- After footer scripts -->
  <!-- scripts -->
<script src="/js/app.js"></script>

<script>
  var disqus_shortname = 'blog-timeicode-com';

  
  var disqus_url = '//blog.time0x.com/2018/06/18/php-简洁之道/';
  

  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>



</body>

</html>